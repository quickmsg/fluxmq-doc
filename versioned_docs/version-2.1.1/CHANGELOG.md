# 更新日志

## [2.1.1] - 2024-02-15

### 🐛 问题修复

#### 规则引擎
- 修复规则引擎在高并发场景下的内存泄漏问题
- 修复批量处理时的数据一致性问题
- 修复SQL解析器在处理复杂查询时的性能问题
- 修复函数执行时的空指针异常
- 修复规则执行顺序导致的竞态条件

#### 数据源连接
- 修复MySQL连接池在长时间运行后的连接泄漏问题
- 修复Redis连接超时导致的规则执行失败
- 修复Kafka消息发送时的重试机制问题
- 修复PostgreSQL事务回滚时的数据不一致问题
- 修复ClickHouse批量插入时的性能问题

#### 系统稳定性
- 修复高并发场景下的内存溢出问题
- 修复集群节点通信异常导致的脑裂问题
- 修复配置热重载时的竞态条件
- 修复日志文件轮转时的文件句柄泄漏
- 修复JVM内存管理优化

### 🔧 功能改进

#### 性能优化
- **规则引擎性能提升**
  - 批量处理性能提升 15%
  - 内存使用优化 20%
  - SQL解析性能提升 25%
- **消息处理优化**
  - 消息路由算法优化
  - 连接处理性能提升 10%
  - 集群通信延迟降低 30%
- **存储性能提升**
  - 数据持久化性能提升 20%
  - 索引查询优化
  - 缓存命中率提升 15%

#### 稳定性改进
- **错误恢复机制**
  - 增强自动故障检测
  - 改进故障转移逻辑
  - 支持更细粒度的重试策略
- **数据一致性**
  - 改进分布式事务处理
  - 增强数据一致性保证
  - 优化并发控制机制

#### 监控和可观测性
- **指标收集优化**
  - 新增规则执行成功率指标
  - 新增数据源连接状态监控
  - 新增系统资源使用监控
- **日志改进**
  - 优化日志输出格式
  - 新增结构化日志支持
  - 改进错误日志的可读性
- **告警机制**
  - 新增规则执行失败告警
  - 新增数据源连接异常告警
  - 新增系统资源使用告警

### 🚀 新增功能

#### 规则引擎增强
- **新增数据源支持**
  - 支持MongoDB数据存储
  - 支持InfluxDB时序数据存储
  - 支持Elasticsearch数据存储
- **规则管理优化**
  - 支持规则批量导入导出
  - 支持规则版本管理
  - 支持规则执行历史查询
- **性能监控**
  - 新增规则执行时间统计
  - 新增规则错误率监控
  - 新增规则吞吐量监控

#### 配置管理
- **配置验证增强**
  - 新增配置语法检查
  - 新增配置依赖检查
  - 新增配置冲突检测
- **热重载优化**
  - 支持部分配置热重载
  - 支持配置回滚功能
  - 支持配置变更通知

#### 安全增强
- **认证鉴权**
  - 支持OAuth2.0认证
  - 支持JWT令牌验证
  - 支持多因子认证
- **访问控制**
  - 支持细粒度权限控制
  - 支持角色基础访问控制
  - 支持API访问限制

### 🔄 兼容性说明

#### 向后兼容
- 所有2.1.0版本的配置文件和API保持兼容
- 现有规则引擎配置无需修改
- 数据源配置保持兼容
- 集群配置保持兼容

#### 升级建议
- 建议在测试环境验证后再升级生产环境
- 备份重要配置和数据
- 查看升级指南了解详细步骤
- 建议在低峰期进行升级

### 📊 性能数据

#### 基准测试结果
- **消息吞吐量**：120万消息/秒（相比2.1.0提升20%）
- **连接数**：支持12万并发连接（相比2.1.0提升20%）
- **规则执行**：单规则执行时间 < 0.8ms（相比2.1.0提升20%）
- **内存使用**：相比2.1.0版本减少15%

#### 压力测试结果
- **稳定性**：7x24小时稳定运行
- **错误率**：< 0.005%（相比2.1.0降低50%）
- **延迟**：P99延迟 < 8ms（相比2.1.0提升20%）
- **CPU使用**：平均CPU使用率 < 25%（相比2.1.0降低5%）

### 🚨 重要说明

#### 升级注意事项
1. **数据库升级**：需要执行数据库升级脚本
2. **配置更新**：部分配置项需要更新
3. **API兼容**：部分API接口有变更
4. **性能测试**：建议升级后进行性能测试
5. **监控配置**：需要更新监控配置

#### 废弃功能
- 废弃旧版本的部分配置项
- 废弃旧版本的API接口
- 废弃旧版本的数据表结构

#### 已知问题
- 在特定场景下可能存在内存使用过高的问题（已优化）
- 集群模式下可能存在节点同步延迟（已优化）
- 高并发场景下可能存在连接池耗尽问题（已优化）

---

## [2.1.0] - 2024-01-15

### 🚀 新增功能

#### 规则引擎增强
- **新增数据源支持**
  - 支持 ClickHouse 数据存储
  - 支持 Pulsar 消息发送
  - 支持 RocketMQ 消息发送
  - 支持 TDengine 时序数据存储
- **性能监控**
  - 新增规则执行性能监控
  - 支持规则执行时间统计
  - 支持规则错误率监控
- **错误处理**
  - 增强错误重试机制
  - 支持死信队列配置
  - 改进错误日志记录

#### 配置管理
- **配置验证**
  - 增强配置文件验证
  - 提供详细的错误提示
  - 支持配置语法检查
- **热重载**
  - 支持配置热重载
  - 无需重启服务即可应用新配置
- **配置模板**
  - 提供常用配置模板
  - 简化配置过程

#### 可观测性
- **指标收集**
  - 新增系统性能指标
  - 支持自定义指标收集
  - 提供 Prometheus 格式指标
- **日志优化**
  - 结构化日志输出
  - 支持日志级别配置
  - 改进日志格式
- **告警机制**
  - 内置告警规则
  - 支持多种通知方式
  - 可配置告警阈值

### 🔧 功能改进

#### 性能优化
- **规则引擎性能**
  - 批量处理性能提升 30%
  - 内存使用优化 25%
  - SQL 解析性能提升 40%
- **消息处理**
  - 消息路由优化
  - 连接处理改进
  - 集群通信优化
- **存储优化**
  - 数据持久化性能提升
  - 索引查询优化
  - 缓存机制改进

#### 稳定性改进
- **错误恢复**
  - 增强错误恢复机制
  - 改进故障检测
  - 支持自动故障转移
- **数据一致性**
  - 改进事务处理
  - 增强数据一致性保证
  - 支持分布式事务

#### 开发体验
- **API 改进**
  - 简化 API 接口
  - 改进错误响应
  - 增强 API 文档
- **文档完善**
  - 更新所有文档
  - 添加使用示例
  - 提供最佳实践

### 🐛 问题修复

#### 规则引擎
- 修复 SQL 解析器内存泄漏问题
- 修复批量处理时的并发问题
- 修复函数执行时的空指针异常
- 修复规则执行顺序问题

#### 数据源
- 修复 MySQL 连接池泄漏问题
- 修复 Redis 连接超时问题
- 修复 Kafka 消息发送失败问题
- 修复 PostgreSQL 事务回滚问题

#### 系统稳定性
- 修复高并发下的内存溢出问题
- 修复集群节点通信异常
- 修复配置热重载时的竞态条件
- 修复日志文件轮转问题

### 🔄 兼容性变更

#### 配置变更
- 新增 `offlineMessage` 配置项
- 新增 `ruleEngineMetrics` 配置项
- 修改 `pool` 配置结构
- 废弃部分旧配置项

#### API 变更
- 新增规则引擎监控 API
- 修改部分 API 响应格式
- 废弃部分旧 API 接口

#### 数据库变更
- 新增离线消息表
- 新增规则引擎监控表
- 修改部分表结构

### 📚 文档更新

- 更新安装部署文档
- 新增规则引擎使用指南
- 新增数据源配置文档
- 更新 API 文档
- 新增性能调优指南
- 新增故障排查指南

### 🔧 依赖更新

- 升级 Spring Boot 到 3.2.0
- 升级 Netty 到 4.1.100
- 升级 MySQL 驱动到 8.0.33
- 升级 Redis 客户端到 4.3.1
- 升级 Kafka 客户端到 3.5.1

### 🚨 重要说明

#### 升级注意事项
1. **数据库升级**：需要执行数据库升级脚本
2. **配置更新**：部分配置项需要更新
3. **API 兼容**：部分 API 接口有变更
4. **性能测试**：建议升级后进行性能测试

#### 废弃功能
- 废弃旧版本的部分配置项
- 废弃旧版本的 API 接口
- 废弃旧版本的数据表结构

#### 已知问题
- 在特定场景下可能存在内存使用过高的问题
- 集群模式下可能存在节点同步延迟
- 高并发场景下可能存在连接池耗尽问题

### 📊 性能数据

#### 基准测试结果
- **消息吞吐量**：100万消息/秒
- **连接数**：支持10万并发连接
- **规则执行**：单规则执行时间 < 1ms
- **内存使用**：相比2.0.x版本减少25%

#### 压力测试结果
- **稳定性**：7x24小时稳定运行
- **错误率**：< 0.01%
- **延迟**：P99延迟 < 10ms
- **CPU使用**：平均CPU使用率 < 30%

---

## [2.0.19] - 2023-12-20

### 🐛 问题修复
- 修复规则引擎内存泄漏问题
- 修复集群节点通信异常
- 修复配置热重载问题

### 🔧 功能改进
- 优化消息处理性能
- 改进错误处理机制
- 增强日志记录

---

## [2.0.18] - 2023-12-10

### 🚀 新增功能
- 新增 Redis 数据源支持
- 新增规则引擎基础功能
- 新增集群管理功能

### 🔧 功能改进
- 优化连接处理性能
- 改进配置管理
- 增强监控功能

---

## [2.0.17] - 2023-11-30

### 🐛 问题修复
- 修复高并发连接问题
- 修复消息丢失问题
- 修复内存使用问题

### 🔧 功能改进
- 优化系统性能
- 改进错误处理
- 增强稳定性

---

## 版本历史

### 2.1.x 系列
- **2.1.1** - 稳定性修复和性能优化版本
  - 修复多个关键问题
  - 性能进一步提升
  - 增强系统稳定性
- **2.1.0** - 重大功能增强版本
  - 新增多种数据源支持
  - 规则引擎性能大幅提升
  - 增强可观测性功能

### 2.0.x 系列
- **2.0.19** - 稳定性修复版本
- **2.0.18** - 功能增强版本
- **2.0.17** - 问题修复版本

### 1.x 系列
- **1.9.x** - 早期版本，已停止维护
- **1.8.x** - 早期版本，已停止维护

---

## 贡献者

感谢所有为 FluxMQ 2.1.1 做出贡献的开发者！

### 核心贡献者
- 开发团队
- 测试团队
- 文档团队
- 社区贡献者

### 特别感谢
- 所有用户反馈和建议
- 开源社区的支持
- 合作伙伴的协助

---

## 许可证

FluxMQ 采用 Apache License 2.0 开源许可证。